services:
    moto:
        container_name: serverlesslaunchpad-moto
        image: motoserver/moto:latest
        ports:
            - "5555:5000" # Moto server port (external:internal)
        environment:
            # Enable all services your app needs
            - MOTO_HOST=0.0.0.0
            - MOTO_PORT=5000
            # Disable Cognito IDP (handled by cognito-local)
            - MOTO_COGNITO_IDP_ENABLED=false
            # Enable specific services
            - MOTO_COGNITO_IDP_USER_POOL_DOMAIN_CERT_VALIDATION=false
        command: ["-H", "0.0.0.0", "-p", "5000"]
        networks:
            - serverlesslaunchpad
        healthcheck:
            test: ["CMD", "curl", "-f", "http://localhost:5000/"]
            interval: 10s
            timeout: 5s
            retries: 3

    cognito-local:
        container_name: serverlesslaunchpad-cognito-local
        image: jagregory/cognito-local:latest
        ports:
            - "9230:9230" # Cognito Local port (external:internal) - using 9230 to avoid conflict with Node.js debug port
        volumes:
            - ./.cognito:/app/.cognito # Persist user pools and users
        environment:
            - PORT=9230
            - DEBUG=true
            - HOST=0.0.0.0
        networks:
            - serverlesslaunchpad
        healthcheck:
            test: ["CMD", "curl", "-f", "http://localhost:9230/"]
            interval: 10s
            timeout: 5s
            retries: 3
        depends_on:
            moto:
                condition: service_healthy

networks:
    serverlesslaunchpad:
        driver: bridge
